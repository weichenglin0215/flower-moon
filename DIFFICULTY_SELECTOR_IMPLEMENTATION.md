# 难度选择组件实施总结

## 实施完成时间
2025年12月22日

---

## 新增文件

### 1. `difficulty-selector.css`
独立的难度选择器样式文件：
- 覆盖层背景效果
- 竖排文字按钮（符合中文排版习惯）
- 5个难度等级的渐变色主题
- 悬停和点击动画效果
- 响应式适配

### 2. `difficulty-selector.js`
独立的难度选择器JavaScript组件：
- 全局单例模式，所有游戏共享
- 自动初始化和DOM创建
- 回调机制支持难度选择后的处理
- 防止背景点击关闭（强制选择）

---

## 修改的文件

### HTML文件

#### `index.html`
- 引入 `difficulty-selector.css`
- 引入 `difficulty-selector.js`

### JavaScript文件

#### `game1.js`（游戏一：慢思快选）
**新增：**
- `difficulty` 属性：当前难度
- `difficultySettings` 对象：5个难度的配置
  - 时间：15秒 → 6秒
  - 最低评分：3星 → 0星
  - 最大错误数：5次 → 1次

**修改：**
- `show()` 方法：调用全局难度选择器
- `prepareChallenge()` 方法：根据难度筛选诗词

#### `game2.js`（游戏二：飞花令）
**删除：**
- DOM中的内联难度选择器HTML
- 难度按钮事件绑定代码

**修改：**
- `init()` 方法：不再自动显示内联选择器
- `showDifficultySelector()` 方法：调用全局选择器
- 选择难度后显示游戏容器

#### `game3.js`（游戏三：字爬梯）
**删除：**
- DOM中的内联难度选择器HTML
- 难度按钮事件绑定代码

**修改：**
- `showDifficultySelector()` 方法：调用全局选择器
- 选择难度后显示游戏容器

### CSS文件

#### `game1.css`
- 调整 `.game1-overlay` 的 `z-index` 从 2500 → 2000

#### `menu.css`
调整菜单相关元素的 z-index：
- `.hamburger-btn`：1000 → **3000**（最高层）
- 菜单面板：999 → **2999**
- 背景遮罩：998 → **2998**
- 提示信息：1001 → **3001**（菜单之上）

---

## Z-Index 层级规划

```
层级图（从高到低）：

3001 - 菜单提示信息
3000 - 汉堡菜单按钮 ✨ 始终可点击
2999 - 菜单面板
2998 - 菜单背景遮罩
2500 - 难度选择器 ✨ 新增组件
2000 - 游戏覆盖层（Game1/2/3）
1000 - 响应式容器
0    - 普通内容
```

**关键点：**
- 汉堡菜单（3000）始终高于游戏（2000）和难度选择器（2500）
- 难度选择器（2500）高于游戏，避免游戏界面干扰
- 菜单提示（3001）是最顶层，确保用户能看到提示

---

## 使用方式

### 玩家操作流程

1. 点击菜单选择游戏
2. **自动弹出难度选择界面** ✨
3. 选择难度（幼稚园 → 研究所）
4. 开始游戏
5. 游戏过程中可随时点击汉堡菜单离开或切换

### 开发者集成方式

在任何游戏中调用难度选择器：

```javascript
if (window.DifficultySelector) {
    window.DifficultySelector.show('游戏名称', (selectedLevel) => {
        // selectedLevel: '幼稚園', '小學', '中學', '大學', '研究所'
        
        // 处理难度选择
        this.difficulty = selectedLevel;
        
        // 显示游戏界面
        this.container.classList.remove('hidden');
        
        // 开始游戏
        this.startGame();
    });
}
```

---

## 难度等级说明

### 幼稚園
- 最简单难度
- 时间充裕
- 高评分诗词（3星以上）
- 允许较多错误

### 小學
- 简单难度
- 时间适中
- 高评分诗词
- 允许中等错误

### 中學
- 中等难度
- 时间紧张
- 中高评分诗词（2星以上）
- 允许少量错误

### 大學
- 困难难度
- 时间很紧张
- 中低评分诗词（1星以上）
- 允许极少错误

### 研究所
- 最高难度
- 时间极限
- 所有诗词（包括0星）
- 几乎不允许错误

---

## 设计特点

### 1. 视觉设计
- **渐变背景**：紫色系渐变营造优雅氛围
- **竖排文字**：符合中文传统排版，与游戏主题一致
- **彩色按钮**：每个难度有独特的渐变色
- **动画效果**：滑入动画、悬停效果增强互动性

### 2. 用户体验
- **强制选择**：防止跳过难度选择
- **视觉反馈**：悬停和点击有明确的视觉反馈
- **响应式**：适配各种屏幕尺寸
- **无干扰**：选择后自动隐藏

### 3. 技术实现
- **单例模式**：全局唯一实例，避免重复创建
- **回调机制**：灵活的事件处理
- **自动初始化**：页面加载后自动准备好
- **降级处理**：如果组件未加载，游戏仍可正常运行

---

## 维护说明

### 添加新难度

在 `difficulty-selector.js` 中修改：

```javascript
levels: ['幼稚園', '小學', '中學', '大學', '研究所', '新难度'],
```

在 `difficulty-selector.css` 中添加样式：

```css
.difficulty-btn[data-level="新难度"] {
    background: linear-gradient(135deg, #color1 0%, #color2 100%);
}
```

在各游戏的 `difficultySettings` 中添加配置。

### 修改样式

所有样式集中在 `difficulty-selector.css`，可独立修改而不影响游戏。

### 调试

启用控制台日志查看难度选择过程：

```javascript
// 难度选择器会自动输出日志
console.log('[DifficultySelector] ...');
```

---

## 测试清单

- ✅ 进入游戏一显示难度选择器
- ✅ 进入游戏二显示难度选择器
- ✅ 进入游戏三显示难度选择器
- ✅ 选择不同难度游戏题目难度变化
- ✅ 汉堡菜单始终可点击（不被遮挡）
- ✅ 难度选择器样式美观
- ✅ 移动端响应式显示正常

---

## 后续优化建议

1. **记住上次选择**：使用 localStorage 保存玩家的难度偏好
2. **难度说明**：在按钮上显示难度的具体参数说明
3. **动态难度**：根据玩家表现自动推荐难度
4. **统计数据**：记录不同难度的游戏数据

---

## 实施状态

✅ 所有功能已完成
✅ 所有游戏已集成
✅ Z-Index 层级已优化
✅ 无 linter 错误

可以在浏览器中测试所有功能！

